<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Кейс‑казино • Telegram версия</title>
  <!--
    Этот документ представляет собой переработанную версию оригинального «Кейс‑казино»,
    приспособленную для использования как обычного сайта, так и мини‑приложения
    Telegram. Основные изменения включают поддержку безопасных отступов для
    полноэкранного режима, использование CSS‑переменных для динамического
    применения темы Telegram, более гибкие размеры и улучшенную доступность.

    Чтобы изменить тему, скрипт внизу страницы считывает параметры Telegram
    (bg_color, text_color, button_color и др.) и применяет их к переменным,
    определённым в :root. Если приложение запущено вне Telegram, используются
    стандартные значения.

    Согласно рекомендациям Telegram Mini Apps, все элементы имеют мобильную
    ориентацию и соблюдают безопасную зону экрана【365779233254398†L342-L354】.
  -->
  <!-- Подключаем скрипт Telegram Web Apps SDK. Он не помешает, если страница
       открыта как обычный сайт: наличие объекта Telegram проверяется в коде -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg-color: #0a1a0a;
      --text-color: #ffffff;
      --card-bg: rgba(0, 0, 0, 0.6);
      --btn-gradient-start: #ffea70;
      --btn-gradient-end: #d4af37;
      --btn-text-color: #0e0e0e;
      --felt-green: #0d4d0d;
      --felt-dark: #062806;
      --felt-border: #1a6b1a;
    }

    /* Сброс отступов и базовая типографика */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      /* Поддержка безопасных зон для устройств с вырезами (iPhone) */
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      overflow-y: auto;
      touch-action: manipulation;
    }

    /* Общие стили для всех страниц */
    .page {
      position: absolute;
      inset: 0;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 16px;
      gap: 1rem;
      background-color: var(--bg-color);
      background-size: cover;
      background-position: center;
      overflow-y: auto;
    }

    /* Заголовки и подзаголовки */
    h1 {
      font-size: clamp(1.7rem, 6.5vw, 2.4rem);
      text-align: center;
      line-height: 1.2;
      text-shadow: 0 3px 12px #000;
      margin-top: 0.5rem;
    }

    .subtitle {
      font-size: clamp(1rem, 4vw, 1.2rem);
      text-align: center;
      line-height: 1.35;
      max-width: 96%;
      opacity: 0.92;
      margin-bottom: 0.5rem;
    }

    /* Кнопки */
    .btn {
      padding: 14px 32px;
      font-size: clamp(1.05rem, 4.2vw, 1.15rem);
      font-weight: 600;
      background-image: linear-gradient(145deg, var(--btn-gradient-start), var(--btn-gradient-end));
      color: var(--btn-text-color);
      border: none;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.55);
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease;
      min-width: 150px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 234, 112, 0.35);
    }

    .btn:active {
      transform: scale(0.97);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 14px 20px;
      width: 100%;
      margin-top: auto;
      padding-bottom: 12px;
    }

    /* Звёздный фон для генераторов */
    .stars {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .star {
      position: absolute;
      background: #fff;
      border-radius: 50%;
      opacity: 0.3;
      animation: twinkle 5s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.12; transform: scale(0.95); }
      50%      { opacity: 0.35; transform: scale(1.05); }
    }

    /* Переходы страниц — казино */
    .page {
      animation: pageIn 0.45s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes pageIn {
      from { opacity: 0; transform: translateY(16px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    #home .card:nth-child(1) { animation: cardDeal 0.8s cubic-bezier(0.34, 1.2, 0.64, 1) 0.3s both; }
    #home .card:nth-child(2) { animation: cardDeal 0.8s cubic-bezier(0.34, 1.2, 0.64, 1) 0.45s both; }

    @keyframes cardDeal {
      from { opacity: 0; transform: translateY(30px) rotate(-12deg); }
      to { opacity: 1; transform: translateY(0) rotate(0); }
    }

    /* Анимация появления ТЗ */
    .tz-box.reveal {
      animation: tzReveal 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes tzReveal {
      from { opacity: 0; transform: translateY(-12px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    /* Слот-машина: ручка → джекпот */
    #design .gen-wrap {
      position: relative;
      cursor: pointer;
    }

    #design .gen-img {
      transform-style: preserve-3d;
      transition: filter 0.3s;
    }

    #design .gen-img.spinning {
      animation: slotLeverPull 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    #design .gen-img.jackpot {
      animation: jackpotGlow 0.6s ease-out forwards;
    }

    @keyframes slotLeverPull {
      0% { transform: scale(1) rotateY(0deg); filter: brightness(1); }
      25% { transform: scale(1.02) rotateY(-8deg); filter: brightness(1.1); }
      50% { transform: scale(1.08) rotateY(5deg); filter: brightness(1.2); }
      75% { transform: scale(1.05) rotateY(-2deg); filter: brightness(1.15); }
      100% { transform: scale(1) rotateY(0deg); filter: brightness(1); }
    }

    @keyframes jackpotGlow {
      0% { filter: drop-shadow(0 0 0 transparent) brightness(1); }
      50% { filter: drop-shadow(0 0 30px rgba(255,234,112,0.9)) brightness(1.4); }
      100% { filter: drop-shadow(0 0 12px rgba(255,234,112,0.5)) brightness(1.1); }
    }

    /* Кубики: стакан приподнимается, выпадает комбинация */
    #marketing .gen-wrap {
      position: relative;
      cursor: pointer;
    }

    .gen-img.shaking {
      animation: cupLift 0.9s cubic-bezier(0.34, 1.2, 0.64, 1) forwards;
    }

    @keyframes cupLift {
      0% { transform: translateY(0) scale(1); }
      20% { transform: translateY(-15px) scale(1.05); }
      40% { transform: translateY(-25px) scale(1.08); }
      60% { transform: translateY(-20px) scale(1.06); }
      80% { transform: translateY(-8px) scale(1.02); }
      100% { transform: translateY(0) scale(1); }
    }

    /* Главная — зелёный стол казино */
    #home {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 2vh;
      background: linear-gradient(160deg, var(--felt-dark) 0%, var(--felt-green) 40%, var(--felt-dark) 100%);
      background-image: url('home_bg.webp'), linear-gradient(160deg, var(--felt-dark) 0%, var(--felt-green) 40%, var(--felt-dark) 100%);
      background-size: cover, 100% 100%;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    #home::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse 80% 50% at 50% 80%, transparent 0%, rgba(0,0,0,0.15) 100%);
      pointer-events: none;
    }

    #home img.hand {
      width: clamp(200px, 48vw, 280px);
      animation: handDeal 2s cubic-bezier(0.34, 1.2, 0.64, 1) forwards;
      margin-bottom: 16px;
      filter: drop-shadow(0 8px 16px rgba(0,0,0,0.4));
    }

    @keyframes handDeal {
      0% { opacity: 0; transform: translateY(40px) translateX(-20px) rotate(-5deg) scale(0.9); }
      60% { opacity: 1; transform: translateY(0) translateX(0) rotate(2deg) scale(1.02); }
      100% { transform: translateY(0) translateX(0) rotate(0) scale(1); }
    }

    #home .cards {
      display: flex;
      gap: 24px;
      margin: 12px 0;
      perspective: 1000px;
    }

    #home .card {
      width: clamp(100px, 32vw, 150px);
      cursor: pointer;
      transform-style: preserve-3d;
      transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.35s ease, filter 0.3s;
      border-radius: 8px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.5), 0 0 0 2px var(--felt-border);
    }

    #home .card:hover {
      transform: translateY(-12px) scale(1.06) rotate(-2deg);
      box-shadow: 0 16px 32px rgba(0,0,0,0.5), 0 0 24px rgba(255,234,112,0.3);
      filter: brightness(1.15);
    }

    #home .card:active {
      transform: translateY(-4px) scale(1.03);
    }

    #home .pick-hint {
      font-size: clamp(1rem, 4vw, 1.2rem);
      padding: 10px 24px;
      background: rgba(0,0,0,0.4);
      border-radius: 24px;
      border: 2px solid rgba(255,234,112,0.4);
      animation: chipGlow 2.5s ease-in-out infinite;
      box-shadow: inset 0 0 12px rgba(255,234,112,0.1);
    }

    @keyframes chipGlow {
      0%, 100% { opacity: 0.9; box-shadow: inset 0 0 12px rgba(255,234,112,0.1), 0 0 8px rgba(255,234,112,0.2); }
      50% { opacity: 1; box-shadow: inset 0 0 16px rgba(255,234,112,0.3), 0 0 12px rgba(255,234,112,0.4); }
    }

    #home .card.picked {
      animation: cardPicked 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes cardPicked {
      0% { transform: rotateY(0) scale(1); filter: brightness(1); }
      30% { transform: rotateY(25deg) scale(1.12); filter: brightness(1.4); }
      70% { transform: rotateY(-10deg) scale(1.08); filter: brightness(1.2); }
      100% { transform: rotateY(0) scale(1.05); filter: brightness(1.1); }
    }

    /* Страница загрузки — рука плавно переходит в девушку */
    #loading {
      background: linear-gradient(180deg, #0a0a12 0%, #1a0a12 100%);
      background-image: url('scene_bg.webp'), linear-gradient(180deg, #0a0a12 0%, #1a0a12 100%);
      background-size: cover, 100% 100%;
      justify-content: flex-start;
      align-items: center;
      padding-top: 6vh;
    }

    #loading .scene-wrap {
      position: relative;
      width: 100%;
      max-width: 360px;
      min-height: 50vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #loading .scene-wrap img {
      position: absolute;
      width: clamp(220px, 55vw, 340px);
      max-height: 52vh;
      object-fit: contain;
      object-position: center bottom;
    }

    /* Рука (как на главной) — уходит вниз и растворяется */
    #loading .scene-wrap img.hand {
      width: clamp(200px, 48vw, 280px);
      animation: handToGirl 2.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    /* Девушка — проявляется на месте руки */
    #loading .scene-wrap img.dealer {
      animation: girlReveal 2.2s cubic-bezier(0.4, 0, 0.2, 1) forwards, dealerWave 2.5s ease-in-out 2.2s infinite;
    }

    @keyframes handToGirl {
      0%   { opacity: 1; transform: translate(0, 0) scale(1); filter: brightness(1); }
      30%  { opacity: 1; transform: translate(-15px, 0) scale(1); }
      60%  { opacity: 0.4; transform: translate(-35px, 20px) scale(0.9); filter: brightness(0.7); }
      100% { opacity: 0; transform: translate(-50px, 40px) scale(0.82); filter: brightness(0.5); pointer-events: none; }
    }

    @keyframes girlReveal {
      0%   { opacity: 0; transform: translate(40px, 20px) scale(0.92); filter: blur(6px); }
      40%  { opacity: 0.2; transform: translate(25px, 10px) scale(0.95); filter: blur(3px); }
      70%  { opacity: 0.85; transform: translate(8px, 2px) scale(0.98); filter: blur(0); }
      100% { opacity: 1; transform: translate(0, 0) scale(1); filter: blur(0); }
    }

    @keyframes dealerWave {
      0%, 100% { transform: translateY(0) rotate(-1deg); }
      50% { transform: translateY(-8px) rotate(1deg); }
    }

    #loading .dialog {
      text-align: center;
      margin-top: auto;
      padding: 16px 20px;
      max-width: 92%;
      background: rgba(0,0,0,0.5);
      border-radius: 16px;
      border: 2px solid rgba(255,234,112,0.25);
      box-shadow: inset 0 0 20px rgba(255,234,112,0.05);
    }

    #loading .dialog p {
      font-size: clamp(1rem, 4vw, 1.15rem);
      line-height: 1.4;
    }

    /* Страницы генераторов */
    #design,
    #marketing {
      justify-content: flex-start;
      align-items: center;
      padding-top: 5vh;
      gap: 1.2vh;
    }

    #design {
      background-image: url('design_bg.webp');
      perspective: 600px;
    }
    #marketing { background-image: url('marketing_bg.webp'); }

    .gen-wrap {
      margin: 12px 0 16px;
      display: inline-flex;
      justify-content: center;
      align-items: center;
    }

    .gen-img {
      width: clamp(160px, 42vw, 220px);
      cursor: pointer;
      transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .gen-wrap:hover .gen-img {
      transform: scale(1.06);
    }

    #design .gen-wrap:hover .gen-img { animation: slotPulse 1.5s ease-in-out infinite; }
    #marketing .gen-wrap:hover .gen-img { animation: diceFloat 2s ease-in-out infinite; }

    @keyframes slotPulse {
      0%, 100% { filter: drop-shadow(0 0 8px rgba(255, 234, 112, 0.4)); }
      50% { filter: drop-shadow(0 0 20px rgba(255, 234, 112, 0.7)); }
    }

    @keyframes diceFloat {
      0%, 100% { transform: scale(1.08) translateY(0); }
      50% { transform: scale(1.08) translateY(-4px); }
    }

    /* Контейнер ТЗ — стиль казино (фишка/карта) */
    .tz-box {
      background: linear-gradient(145deg, rgba(20,20,20,0.9) 0%, rgba(10,10,10,0.95) 100%);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 14px 18px;
      width: 92%;
      max-width: 500px;
      font-size: clamp(0.92rem, 3.5vw, 1.1rem);
      line-height: 1.45;
      word-wrap: break-word;
      border: 2px solid rgba(255,234,112,0.2);
      box-shadow: inset 0 0 24px rgba(255,234,112,0.05), 0 4px 20px rgba(0,0,0,0.4);
    }

    .tz-box .tz {
      margin: 4px 0;
    }

    /* Чекбоксы в дизайнерском генераторе */
    .checkboxes {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px 16px;
      margin: 12px 0;
      font-size: clamp(0.9rem, 3.6vw, 1rem);
    }

    .checkboxes label {
      background: rgba(255, 255, 255, 0.07);
      padding: 8px 14px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s ease;
    }

    .checkboxes label:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: scale(1.03);
    }

    .checkboxes input[type="checkbox"] {
      accent-color: var(--btn-gradient-end);
    }

    .checkboxes input[type="text"] {
      background: rgba(255, 255, 255, 0.07);
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      color: var(--text-color);
      outline: none;
      width: 140px;
    }

    select {
      padding: 10px 16px;
      font-size: 1rem;
      background: rgba(30, 30, 30, 0.75);
      color: var(--text-color);
      border: 1px solid #444;
      border-radius: 8px;
      margin: 10px 0;
      width: 90%;
      max-width: 360px;
    }

    /* Toast — фишка казино */
    .toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: linear-gradient(145deg, #ffea70 0%, #d4af37 100%);
      color: #0e0e0e;
      padding: 14px 28px;
      border-radius: 50px;
      font-weight: 700;
      font-size: 1rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.4);
      border: 2px solid rgba(0,0,0,0.15);
      opacity: 0;
      pointer-events: none;
      z-index: 1000;
      transition: opacity 0.25s ease, transform 0.25s ease;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
      animation: toastIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    .toast::before {
      content: "✓ ";
      margin-right: 6px;
    }

    @keyframes toastIn {
      from { opacity: 0; transform: translateX(-50%) translateY(10px) scale(0.9); }
      to { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
    }

    /* Конфетти */
    .confetti-wrap {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 999;
      overflow: hidden;
    }

    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 2px;
      top: 30%;
      animation: confettiFall 1s ease-out forwards;
    }

    @keyframes confettiFall {
      0% { opacity: 1; transform: translateY(0) translateX(0) rotate(0deg) scale(1); }
      100% { opacity: 0; transform: translateY(80vh) translateX(var(--dx, 0)) rotate(720deg) scale(0.5); }
    }

    /* JACKPOT! вспышка */
    .jackpot-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      z-index: 998;
      opacity: 0;
    }

    .jackpot-overlay.show {
      animation: jackpotFlash 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    .jackpot-overlay span {
      font-size: clamp(2rem, 8vw, 3.5rem);
      font-weight: 800;
      color: #ffea70;
      text-shadow: 0 0 20px rgba(255,234,112,0.9), 0 0 40px rgba(212,175,55,0.6);
      letter-spacing: 0.1em;
      transform: scale(0.5);
    }

    @keyframes jackpotFlash {
      0% { opacity: 0; background: rgba(0,0,0,0); }
      15% { opacity: 1; background: rgba(0,0,0,0.3); }
      30% { opacity: 1; }
      100% { opacity: 0; background: rgba(0,0,0,0); }
    }

    .jackpot-overlay.show span {
      animation: jackpotPop 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes jackpotPop {
      0% { transform: scale(0.3); opacity: 0; }
      40% { transform: scale(1.15); opacity: 1; }
      70% { transform: scale(1); opacity: 1; }
      100% { transform: scale(1.1); opacity: 0; }
    }

    /* Тряска экрана */
    body.shake {
      animation: screenShake 0.4s cubic-bezier(0.36, 0.07, 0.19, 0.97) forwards;
    }

    @keyframes screenShake {
      0%, 100% { transform: translate(0, 0); }
      10% { transform: translate(-4px, 2px); }
      20% { transform: translate(4px, -2px); }
      30% { transform: translate(-3px, 3px); }
      40% { transform: translate(3px, -3px); }
      50% { transform: translate(-2px, 2px); }
      60% { transform: translate(2px, -2px); }
      70% { transform: translate(-1px, 1px); }
      80% { transform: translate(1px, -1px); }
    }

    /* Shimmer на кнопках */
    .btn {
      position: relative;
      overflow: hidden;
    }

    .btn::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: none;
    }

    .btn:hover::after {
      animation: btnShimmer 0.6s ease-out forwards;
    }

    @keyframes btnShimmer {
      to { left: 100%; }
    }

    /* Плавающие фишки на главной */
    #home .chips-float {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }

    #home .chip {
      position: absolute;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffea70, #d4af37);
      border: 2px solid rgba(0,0,0,0.2);
      opacity: 0.15;
      animation: chipFloat 8s ease-in-out infinite;
    }

    @keyframes chipFloat {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(10px, -15px) rotate(90deg); }
      50% { transform: translate(-5px, -25px) rotate(180deg); }
      75% { transform: translate(-15px, -10px) rotate(270deg); }
    }

    /* Пульс ТЗ после генерации */
    .tz-box.reveal {
      animation: tzReveal 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards, tzPulse 2s ease-in-out 0.6s 2 forwards;
    }

    @keyframes tzPulse {
      0%, 100% { box-shadow: inset 0 0 24px rgba(255,234,112,0.05), 0 4px 20px rgba(0,0,0,0.4); border-color: rgba(255,234,112,0.2); }
      50% { box-shadow: inset 0 0 32px rgba(255,234,112,0.15), 0 0 24px rgba(255,234,112,0.3); border-color: rgba(255,234,112,0.5); }
    }

    /* Адаптация для планшетов и десктопов */
    @media (min-width: 768px) {
      h1 { font-size: 2.6rem; }
      .gen-img { width: 240px; }
      .btn { padding: 14px 40px; font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <!-- Главная -->
  <div id="home" class="page">
    <div class="chips-float" id="chips-float"></div>
    <img src="home_hand.png" class="hand" alt="Ладонь, приглашающая выбрать карту" onerror="this.style.display='none'" />
    <div class="cards">
      <img src="card_design.png" class="card" onclick="selectRole('design')" alt="Карта дизайнера" onerror="this.onerror=null;this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22150%22/%3E';this.style.background='linear-gradient(135deg,rgba(255,234,112,0.3),rgba(212,175,55,0.2))'" />
      <img src="card_marketing.png" class="card" onclick="selectRole('marketing')" alt="Карта маркетолога" onerror="this.onerror=null;this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22150%22/%3E';this.style.background='linear-gradient(135deg,rgba(255,234,112,0.3),rgba(212,175,55,0.2))'" />
    </div>
    <p class="pick-hint">Выберите карту</p>
  </div>

  <!-- Страница загрузки: рука (как на главной) плавно переходит в девушку -->
  <div id="loading" class="page">
    <div class="scene-wrap">
      <img src="home_hand.png" class="hand" alt="" onerror="this.style.display='none';this.nextElementSibling.style.animation='girlReveal 0.8s ease-out forwards, dealerWave 2.5s ease-in-out 0.8s infinite'" />
      <img src="scene_dealer.webp" class="dealer" alt="Дилер приглашает" onerror="this.style.display='none'" />
    </div>
    <div class="dialog">
      <p>У меня есть пара интересных кейсов для тебя</p>
      <div class="buttons btn-row">
        <button class="btn" onclick="goToGenerator()">Хорошо, идём</button>
        <button class="btn" onclick="goHome()">Я не определился с картой</button>
      </div>
    </div>
  </div>

  <!-- Генератор для дизайнеров -->
  <div id="design" class="page">
    <div class="stars"></div>
    <h1>Генератор кейсов для дизайнеров</h1>
    <p class="subtitle">Сгенерируйте идею для кейса: вы можете использовать её для лого, презентации, мерча или даже брендбука</p>
    <div class="gen-wrap" onclick="generateDesign()">
      <img src="design_slot.png" class="gen-img" alt="Однорукий бандит — нажмите на ручку" onerror="this.alt='Нажмите для генерации'" />
    </div>
    <div id="design-tz" class="tz-box"></div>
    <div class="checkboxes">
      <label><input type="checkbox" value="логотип" /> Логотип</label>
      <label><input type="checkbox" value="мерч" /> Мерч</label>
      <label><input type="checkbox" value="брендбук" /> Брендбук</label>
      <label><input type="checkbox" value="презентация" /> Презентация</label>
      <label><input type="checkbox" value="маскот" /> Маскот</label>
      <label><input type="text" id="custom-design" placeholder="Своё" /></label>
    </div>
    <div class="btn-row">
      <button class="btn" onclick="copyDesignTZ()">Скопировать ТЗ</button>
      <button class="btn" onclick="clearTZ('design')">Стереть</button>
      <button class="btn" onclick="goHome()">Домой</button>
    </div>
  </div>

  <!-- Генератор для маркетологов -->
  <div id="marketing" class="page">
    <div class="stars"></div>
    <h1>Генератор кейсов для маркетологов</h1>
    <p class="subtitle">Сгенерируйте идею для кейса: вы можете использовать её для презентации, исследования, брендбука, сравнения или любого другого кейса</p>
    <div class="gen-wrap" onclick="generateMarketing()">
      <img src="marketing_dice.png" class="gen-img" alt="Кубики и стакан — нажмите" onerror="this.alt='Нажмите для генерации'" />
    </div>
    <div id="marketing-tz" class="tz-box"></div>
    <select id="marketing-type">
      <option value="презентация">Презентация</option>
      <option value="исследование">Исследование</option>
      <option value="брендбук">Брендбук</option>
      <option value="сравнение">Сравнение</option>
      <option value="другое">Другое</option>
    </select>
    <div class="btn-row">
      <button class="btn" onclick="copyMarketingTZ()">Скопировать ТЗ</button>
      <button class="btn" onclick="clearTZ('marketing')">Стереть</button>
      <button class="btn" onclick="goHome()">Домой</button>
    </div>
  </div>

  <div id="toast" class="toast" aria-live="polite"></div>
  <div id="confetti-wrap" class="confetti-wrap"></div>
  <div id="jackpot-overlay" class="jackpot-overlay"><span>JACKPOT!</span></div>

  <script>
    // Логичные кейсы: компания + продукт + позиционирование связаны по домену (индустрии)
    const caseDomains = [
      {
        company: "CodeCraft Software",
        positioning: "Надежное ПО для бизнеса любого масштаба",
        products: ["CRM‑система", "AI‑платформа для автоматизации", "SaaS‑платформа", "BI‑инструменты"],
        designProblems: ["Устаревший логотип не отражает современный бренд", "Несоответствие цветовой палитры в UI/UX", "Перегруженный интерфейс с лишними элементами", "Плохая визуализация данных в дашбордах", "Проблемы с навигацией в веб‑приложении", "Несогласованность иконок в приложении"],
        marketingProblems: ["Низкий трафик на сайт из поисковиков", "Слабый B2B lead nurturing", "Низкая видимость в поисковых системах", "Проблемы с сегментацией аудитории", "Слабый engagement в контент‑маркетинге", "Высокий cost per click"],
        tasks: ["Разработать кампанию по повышению бренд‑осведомленности", "Проанализировать конкурентов и предложить дифференциацию", "Создать контент для B2B‑аудитории", "Улучшить программу лояльности клиентов", "Облачный B2B‑маркетинг"],
        goals: ["Увеличить долю рынка на 15%", "Достичь 100k SaaS‑подписчиков", "Улучшить точность данных на 25%", "Масштабировать до enterprise", "Обеспечить 99.9% uptime"],
        colors: ["Blue / #0000FF", "Teal / #008080", "Navy / #000080", "Indigo / #4B0082"]
      },
      {
        company: "BrewBuddy Coffee",
        positioning: "Кофе для бодрого старта дня",
        products: ["Кофейные зерна премиум‑класса", "Готовый холодный кофе", "Кофейные капсулы", "Подарочные наборы кофе"],
        designProblems: ["Скучный визуальный стиль упаковки", "Устаревший дизайн баннеров", "Отсутствие уникального маскота", "Низкое качество изображений на сайте", "Несогласованность цветов в палитре", "Плохая композиция landing page"],
        marketingProblems: ["Низкие продажи в offseason", "Слабый бренд‑awareness", "Высокий cart abandonment", "Низкий engagement в соцсетях", "Проблемы с сезонным маркетингом", "Конкуренция в e‑commerce"],
        tasks: ["Кофейный брендинг", "Создать сезонную промо‑стратегию", "Разработать кампанию по повышению бренд‑осведомленности", "Улучшить программу лояльности клиентов", "Маркетинг для кофейной аудитории"],
        goals: ["Достичь 1 тонны продаж кофе в месяц", "Увеличить повторные покупки на 40%", "Расширить онлайн‑присутствие", "Увеличить долю рынка на 15%", "Повысить продажи в offseason на 20%"],
        colors: ["Brown / #A52A2A", "Sienna / #A0522D", "Maroon / #800000", "DarkGoldenrod / #B8860B"]
      },
      {
        company: "GlowBeauty Cosmetics",
        positioning: "Натуральная косметика для сияющей кожи",
        products: ["Кремы для лица", "Сыворотки для кожи", "Маски для лица", "Наборы для ухода"],
        designProblems: ["Устаревшие иллюстрации в мерче", "Низкая привлекательность обложек", "Плохая интеграция видео в интерфейс", "Отсутствие 3D‑элементов для продуктов", "Конфликт стилей в соцсетях", "Слабый дизайн упаковки"],
        marketingProblems: ["Слабый охват в influencer‑маркетинге", "Низкие конверсии из соцсетей", "Проблемы с персонализацией предложений", "Высокий churn rate подписчиков", "Слабый viral эффект кампаний", "Низкий NPS score"],
        tasks: ["Кампания по уходу за кожей", "Уход за кожей маркетинг", "Разработать influencer‑стратегию", "Создать контент для соцсетей", "Улучшить программу лояльности"],
        goals: ["Достичь 5 млн продаж косметики", "Лидер в skincare", "Увеличить retention до 70%", "Расширить онлайн‑присутствие", "Увеличить долю рынка на 15%"],
        colors: ["Pink / #FFC0CB", "HotPink / #FF69B4", "Lavender / #E6E6FA", "Coral / #FF7F50"]
      },
      {
        company: "FitTrack Gear",
        positioning: "Спортивное оборудование для активного образа жизни",
        products: ["Фитнес‑трекеры", "Протеиновые шейкеры", "Йога‑маты и аксессуары", "Спортивная одежда"],
        designProblems: ["Отсутствие анимаций для вовлечения", "Проблемы с responsive дизайном", "Слабый фокус на CTA", "Устаревший стиль икон‑сета", "Плохая визуальная иерархия", "Несовместимость с dark mode"],
        marketingProblems: ["Низкий engagement в webinars", "Проблемы с сегментацией аудитории", "Слабый user‑generated content", "Высокие затраты на acquisition", "Низкий lifetime value клиентов", "Проблемы с ретаргетингом"],
        tasks: ["Маркетинг безопасного фитнеса", "Мотивирующий контент для фитнеса", "Разработать UGC‑кампанию", "Создать сезонную промо‑стратегию", "Улучшить программу лояльности"],
        goals: ["Увеличить engagement в фитнесе", "Минимизировать травмы через образование", "Увеличить retention до 70%", "Достичь 1 млн пользователей", "Расширить онлайн‑присутствие"],
        colors: ["Lime / #00FF00", "Orange / #FFA500", "Cyan / #00FFFF", "Green / #008000"]
      },
      {
        company: "AdventureQuest Travel",
        positioning: "Приключенческие туры для искателей адреналина",
        products: ["Туристические пакеты", "Экскурсионные туры", "Отельные пакеты", "Трекинг‑туры"],
        designProblems: ["Слабый визуальный storytelling в презентациях", "Устаревший дизайн email‑рассылок", "Низкое качество изображений на сайте", "Отсутствие immersive дизайна", "Плохая композиция landing page", "Несогласованность в UI kits"],
        marketingProblems: ["Высокий bounce rate на landing pages", "Низкие конверсии из соцсетей", "Проблемы с сезонным маркетингом", "Слабый PR в СМИ", "Высокие затраты на content creation", "Низкий share of voice"],
        tasks: ["Безопасный туристический маркетинг", "Персонализированный тревел‑маркетинг", "Адаптировать туры под новые регуляции", "Создать контент для соцсетей", "Разработать сезонную промо‑стратегию"],
        goals: ["Обеспечить безопасность туров", "Персонализировать 80% туров", "Увеличить повторные визиты на 40%", "Расширить онлайн‑присутствие", "Достичь 1 млн пользователей"],
        colors: ["Turquoise / #40E0D0", "Teal / #008080", "Coral / #FF7F50", "Gold / #FFD700"]
      },
      {
        company: "StyleForge Apparel",
        positioning: "Современная мода для уверенных в себе людей",
        products: ["Линейка уличной одежды", "Аксессуары для одежды", "Сумки и рюкзаки", "Коллекция базовых вещей"],
        designProblems: ["Конфликт стилей в соцсетях", "Устаревшие иллюстрации в мерче", "Несовместимость брендбука с новыми продуктами", "Слабый дизайн инфографики", "Проблемы с white space в layouts", "Низкая привлекательность обложек"],
        marketingProblems: ["Отток аудитории в соцсетях", "Конкуренция в e‑commerce", "Слабый influencer‑маркетинг", "Низкие подписки на newsletter", "Проблемы с A/B‑тестированием", "Высокий cart abandonment"],
        tasks: ["Трендовый маркетинг моды", "Устойчивый фэшн‑маркетинг", "Создать контент для соцсетей", "Разработать influencer‑стратегию", "Проанализировать конкурентов"],
        goals: ["Лидерство в fast fashion", "Увеличить долю рынка на 15%", "Расширить онлайн‑присутствие", "Увеличить retention до 70%", "Достичь 1 млн подписчиков"],
        colors: ["Black / #000000", "Magenta / #FF00FF", "Silver / #C0C0C0", "Gold / #FFD700"]
      },
      {
        company: "GreenLeaf Energy",
        positioning: "Возобновляемая энергия для зеленого мира",
        products: ["Солнечные панели", "Инверторы для солнечных систем", "Батареи для хранения энергии", "Умные термостаты"],
        designProblems: ["Устаревший логотип не отражает экологичность", "Отсутствие motion design в промо", "Плохая визуализация данных в дашбордах", "Слабый дизайн инфографики", "Несогласованность цветов в палитре", "Проблемы с доступностью"],
        marketingProblems: ["Слабый бренд‑awareness", "Проблемы с B2B lead nurturing", "Низкая видимость в поисковых системах", "Высокие затраты на acquisition", "Проблемы с маркетинг‑автоматизацией", "Низкий share of voice"],
        tasks: ["Продвигать зелёные инициативы", "Продвигать энергоэффективность", "Продвижение солнечной энергии", "Энерго‑хранение продвижение", "Разработать B2B‑кампанию"],
        goals: ["Стать лидером в зеленой энергии", "Снизить энергопотребление на 30%", "Покрыть 20% рынка солнечных", "Хранить 100% энергии", "Привлечь 5 млн инвестиций"],
        colors: ["Green / #008000", "Teal / #008080", "Lime / #00FF00", "ForestGreen / #228B22"]
      },
      {
        company: "PetPals Supplies",
        positioning: "Качественные товары для любимых питомцев",
        products: ["Корм для собак", "Аксессуары для питомцев", "Игрушки для кошек", "Наборы для ухода"],
        designProblems: ["Отсутствие уникального маскота", "Скучный визуальный стиль упаковки", "Низкая привлекательность обложек", "Устаревший дизайн баннеров", "Конфликт стилей в соцсетях", "Проблемы с white space"],
        marketingProblems: ["Слабый охват в influencer‑маркетинге", "Низкие конверсии из соцсетей", "Проблемы с сегментацией аудитории", "Высокий churn rate подписчиков", "Слабый user‑generated content", "Низкий NPS score"],
        tasks: ["Кампании для владельцев питомцев", "Разработать influencer‑стратегию", "Создать UGC‑кампанию", "Улучшить программу лояльности", "Создать контент для соцсетей"],
        goals: ["Стать топ‑брендом для pets", "Увеличить retention до 70%", "Расширить онлайн‑присутствие", "Увеличить долю рынка на 15%", "Достичь 1 млн подписчиков"],
        colors: ["Orange / #FFA500", "Brown / #A52A2A", "Green / #008000", "Gold / #FFD700"]
      },
      {
        company: "EduQuest Learning",
        positioning: "Интерактивное обучение для детей и взрослых",
        products: ["Онлайн‑курсы", "Образовательные приложения", "Пазлы для мозга", "Обучающие материалы"],
        designProblems: ["Плохая читаемость шрифтов на мобильных", "Отсутствие анимаций для вовлечения", "Перегруженный интерфейс", "Проблемы с доступностью", "Слабый дизайн error pages", "Несогласованность иконок"],
        marketingProblems: ["Высокий churn rate подписчиков", "Низкий engagement в webinars", "Проблемы с retention‑маркетингом", "Слабый lead generation", "Высокие затраты на acquisition", "Низкие подписки на newsletter"],
        tasks: ["Retention‑стратегии для курсов", "Маркетинг образовательных инструментов", "Разработать кампанию по повышению бренд‑осведомленности", "Улучшить программу лояльности", "Создать контент для соцсетей"],
        goals: ["Снизить dropout до 10%", "Достичь 1 млн пользователей", "Улучшить концентрацию учеников", "Увеличить retention до 70%", "Расширить онлайн‑присутствие"],
        colors: ["Blue / #0000FF", "Purple / #800080", "Teal / #008080", "Indigo / #4B0082"]
      },
      {
        company: "GameForge Studios",
        positioning: "Игровые студии для эпичных приключений",
        products: ["Видеоигры", "VR‑очки и контент", "Мобильные игры", "Игровые аксессуары"],
        designProblems: ["Отсутствие immersive дизайна для VR", "Устаревший стиль икон‑сета", "Плохая анимация переходов", "Отсутствие 3D‑элементов", "Слабый motion design в промо", "Проблемы с dark mode"],
        marketingProblems: ["Низкие метрики в app installs", "Конкуренция в видео‑рекламе", "Слабый viral эффект кампаний", "Высокие затраты на acquisition", "Проблемы с ретаргетингом", "Низкий engagement в соцсетях"],
        tasks: ["Гейм‑маркетинг", "Разработать viral‑кампанию", "Создать контент для стримеров", "Улучшить программу лояльности", "Маркетинг VR для образования"],
        goals: ["Выпустить хит‑игру", "Достичь 1 млн пользователей", "Сделать VR mainstream", "Увеличить retention до 70%", "Расширить онлайн‑присутствие"],
        colors: ["Purple / #800080", "Cyan / #00FFFF", "Magenta / #FF00FF", "Indigo / #4B0082"]
      }
    ];

    let currentRole = "";
    let currentPageId = "home";
    let tg = null;
    let currentDesignTZ = null;
    let currentMarketingTZ = null;

    function haptic(type) {
      if (tg?.HapticFeedback) {
        if (type === "heavy") tg.HapticFeedback.impactOccurred("heavy");
        else if (type === "medium") tg.HapticFeedback.impactOccurred("medium");
        else if (type === "success") tg.HapticFeedback.notificationOccurred("success");
        else tg.HapticFeedback.impactOccurred("light");
      }
    }

    function showToast(message) {
      const el = document.getElementById("toast");
      el.textContent = message;
      el.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => el.classList.remove("show"), 2000);
    }

    function burstConfetti() {
      const wrap = document.getElementById("confetti-wrap");
      wrap.innerHTML = "";
      const colors = ["#ffea70", "#d4af37", "#ffd700", "#fff", "#ff6b6b"];
      const count = 35;
      for (let i = 0; i < count; i++) {
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.left = (30 + Math.random() * 40) + "%";
        c.style.setProperty("--dx", (Math.random() - 0.5) * 200 + "px");
        c.style.background = colors[Math.floor(Math.random() * colors.length)];
        c.style.animationDelay = Math.random() * 0.15 + "s";
        c.style.animationDuration = (0.8 + Math.random() * 0.5) + "s";
        wrap.appendChild(c);
      }
      setTimeout(() => wrap.innerHTML = "", 1500);
    }

    function showJackpot() {
      const el = document.getElementById("jackpot-overlay");
      el.classList.remove("show");
      el.offsetHeight;
      el.classList.add("show");
      setTimeout(() => el.classList.remove("show"), 1000);
    }

    function screenShake() {
      document.body.classList.remove("shake");
      document.body.offsetHeight;
      document.body.classList.add("shake");
      setTimeout(() => document.body.classList.remove("shake"), 400);
    }

    function randomItem(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function showPage(id) {
      currentPageId = id;
      document.querySelectorAll(".page").forEach(p => p.style.display = "none");
      const el = document.getElementById(id);
      el.style.display = "flex";
      if (id === "design" || id === "marketing") createStars(id);
      if (id === "home") createChips();
      setupTelegramButtons(id);
    }

    function createChips() {
      const wrap = document.getElementById("chips-float");
      if (!wrap || wrap.children.length > 0) return;
      for (let i = 0; i < 6; i++) {
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.style.left = (15 + Math.random() * 70) + "%";
        chip.style.top = (20 + Math.random() * 60) + "%";
        chip.style.animationDelay = (i * 1.2) + "s";
        chip.style.animationDuration = (6 + Math.random() * 4) + "s";
        wrap.appendChild(chip);
      }
    }

    function setupTelegramButtons(pageId) {
      if (!tg) return;
      const BackButton = tg.BackButton;
      const MainButton = tg.MainButton;
      if (BackButton) {
        if (pageId === "home") BackButton.hide();
        else {
          BackButton.show();
          BackButton.offClick(handleBackClick);
          BackButton.onClick(handleBackClick);
        }
      }
      if (MainButton) {
        MainButton.hide();
        if (pageId === "home" && typeof tg.close === "function") {
          MainButton.setText("Закрыть");
          MainButton.show();
          MainButton.offClick(handleCloseClick);
          MainButton.onClick(handleCloseClick);
        } else if (pageId === "design" && currentDesignTZ) {
          MainButton.setText("Скопировать ТЗ");
          MainButton.show();
          MainButton.offClick(copyDesignTZ);
          MainButton.onClick(copyDesignTZ);
        } else if (pageId === "marketing" && currentMarketingTZ) {
          MainButton.setText("Скопировать ТЗ");
          MainButton.show();
          MainButton.offClick(copyMarketingTZ);
          MainButton.onClick(copyMarketingTZ);
        }
      }
    }

    function handleBackClick() {
      haptic("light");
      if (currentPageId === "design" || currentPageId === "marketing") showPage("loading");
      else if (currentPageId === "loading") showPage("home");
    }

    function handleCloseClick() {
      haptic("light");
      if (tg?.close) tg.close();
    }

    function selectRole(role) {
      haptic("medium");
      currentRole = role;
      const card = document.querySelector(`#home .card[onclick*="${role}"]`);
      if (card) {
        card.classList.remove("picked");
        card.offsetHeight;
        card.classList.add("picked");
        setTimeout(() => card.classList.remove("picked"), 700);
      }
      showPage("loading");
    }

    function goToGenerator() {
      haptic("light");
      showPage(currentRole);
    }

    function goHome() {
      haptic("light");
      showPage("home");
    }

    function generateDesign() {
      haptic("medium");
      screenShake();
      burstConfetti();
      const domain = randomItem(caseDomains);
      const col = randomItem(domain.colors);
      const prod = randomItem(domain.products);
      const prob = randomItem(domain.designProblems);
      currentDesignTZ = { company: domain.company, positioning: domain.positioning, color: col, product: prod, problem: prob };
      const tzBox = document.getElementById("design-tz");
      tzBox.classList.remove("reveal");
      tzBox.innerHTML = `
        <p class="tz">Название компании: ${domain.company}</p>
        <p class="tz">Позиционирование: ${domain.positioning}</p>
        <p class="tz">Основной цвет: ${col}</p>
        <p class="tz">Продукт: ${prod}</p>
        <p class="tz">Проблема: ${prob}</p>
      `;
      tzBox.offsetHeight;
      tzBox.classList.add("reveal");
      showJackpot();
      setupTelegramButtons("design");
      const img = document.querySelector("#design .gen-img");
      img.classList.remove("spinning", "jackpot");
      img.offsetHeight;
      img.classList.add("spinning");
      setTimeout(() => {
        img.classList.remove("spinning");
        img.classList.add("jackpot");
        setTimeout(() => img.classList.remove("jackpot"), 600);
      }, 1000);
    }

    function generateMarketing() {
      haptic("medium");
      screenShake();
      burstConfetti();
      const domain = randomItem(caseDomains);
      const prod = randomItem(domain.products);
      const prob = randomItem(domain.marketingProblems);
      const t = randomItem(domain.tasks);
      const g = randomItem(domain.goals);
      currentMarketingTZ = { company: domain.company, positioning: domain.positioning, product: prod, problem: prob, task: t, goal: g };
      const tzBox = document.getElementById("marketing-tz");
      tzBox.classList.remove("reveal");
      tzBox.innerHTML = `
        <p class="tz">Название компании: ${domain.company}</p>
        <p class="tz">Позиционирование: ${domain.positioning}</p>
        <p class="tz">Продукт: ${prod}</p>
        <p class="tz">Проблема: ${prob}</p>
        <p class="tz">Задача: ${t}</p>
        <p class="tz">Цели компании: ${g}</p>
      `;
      tzBox.offsetHeight;
      tzBox.classList.add("reveal");
      showJackpot();
      setupTelegramButtons("marketing");
      const img = document.querySelector("#marketing .gen-img");
      img.classList.remove("shaking");
      img.offsetHeight;
      img.classList.add("shaking");
      setTimeout(() => img.classList.remove("shaking"), 900);
    }

    function showAlert(message) {
      if (tg && typeof tg.showAlert === "function") {
        tg.showAlert(message);
      } else {
        alert(message);
      }
    }

    function copyDesignTZ() {
      if (!currentDesignTZ) {
        showAlert("Сначала сгенерируйте ТЗ");
        return;
      }
      haptic("success");
      const checks = Array.from(document.querySelectorAll("#design input[type=checkbox]:checked")).map(c => c.value);
      const custom = document.getElementById("custom-design").value.trim();
      const items = [...checks, custom].filter(Boolean).join(", ") || "дизайн";
      const d = currentDesignTZ;
      const text = `Привет, я представитель компании ${d.company}. Мы занимаемся в основном реализацией ${d.product} и вот недавно столкнулись со следующей проблемой: ${d.problem}.\n\n` +
                   `Нам срочно нужна твоя помощь! Директор по маркетингу очень просит сделать тебе ${items}. И просит учесть, что ${d.color} — это наш основной цвет, и в целом сам дизайн должен поддерживать наше позиционирование: ${d.positioning}.\n\n` +
                   `В целом мы готовы рассмотреть твои предложения по вайбу и общему настроению — мы доверяем тебе как специалисту. Ноль правок! Ждём твоё решение!`;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          if (tg?.showAlert) tg.showAlert("ТЗ скопировано");
          else showToast("ТЗ скопировано");
        }).catch(() => showAlert(text));
      } else {
        showAlert(text);
      }
    }

    function copyMarketingTZ() {
      if (!currentMarketingTZ) {
        showAlert("Сначала сгенерируйте ТЗ");
        return;
      }
      haptic("success");
      const m = currentMarketingTZ;
      const text = `Привет, я представитель компании ${m.company}. Мы занимаемся в основном реализацией ${m.product} и вот недавно столкнулись со следующей проблемой: ${m.problem}.\n\n` +
                   `Нам срочно нужна твоя помощь! Директор по маркетингу очень просит твоей помощи: помоги решить нашу задачу — ${m.task}.\n\n` +
                   `Думаю, ты и так знаешь, что решение должно коррелироваться с позиционированием (${m.positioning}). В этом квартале наша основная цель: ${m.goal}. Ноль правок! Ждём твоё решение!`;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          if (tg?.showAlert) tg.showAlert("ТЗ скопировано");
          else showToast("ТЗ скопировано");
        }).catch(() => showAlert(text));
      } else {
        showAlert(text);
      }
    }

    function clearTZ(role) {
      haptic("light");
      if (role === "design") {
        currentDesignTZ = null;
        document.querySelectorAll("#design input[type=checkbox]").forEach(i => i.checked = false);
        document.getElementById("custom-design").value = "";
      } else {
        currentMarketingTZ = null;
      }
      document.getElementById(role + "-tz").innerHTML = "";
      setupTelegramButtons(currentPageId);
    }

    // Создание звёздного фона на генераторных страницах
    function createStars(id) {
      const container = document.querySelector(`#${id} .stars`);
      container.innerHTML = "";
      const count = window.innerWidth > 768 ? 60 : 35;
      for (let i = 0; i < count; i++) {
        const s = document.createElement("div");
        s.className = "star";
        const size = Math.random() * 3 + 1;
        s.style.width = size + "px";
        s.style.height = size + "px";
        s.style.top = Math.random() * 100 + "%";
        s.style.left = Math.random() * 100 + "%";
        s.style.animationDelay = Math.random() * 5 + "s";
        container.appendChild(s);
      }
    }

    // Инициализация страницы
    function init() {
      showPage("home");
      // Проверяем наличие Telegram API
      if (window.Telegram && window.Telegram.WebApp) {
        tg = window.Telegram.WebApp;
        tg.ready();
        // Расширяем приложение, если это Mini App
        if (typeof tg.expand === "function") tg.expand();
        // Получаем тему и применяем к CSS‑переменным
        const theme = tg.themeParams || {};
        if (theme.bg_color) document.documentElement.style.setProperty('--bg-color', theme.bg_color);
        if (theme.text_color) document.documentElement.style.setProperty('--text-color', theme.text_color);
        // Telegram предоставляет цвета кнопок. Используем их, если доступны
        if (theme.button_color && theme.button_color.startsWith('#')) {
          document.documentElement.style.setProperty('--btn-gradient-start', theme.button_color);
          document.documentElement.style.setProperty('--btn-gradient-end', theme.button_color);
        }
        if (theme.button_text_color) document.documentElement.style.setProperty('--btn-text-color', theme.button_text_color);
        // Слушаем изменение темы и обновляем цвета
        tg.onEvent('themeChanged', () => {
          const t = tg.themeParams || {};
          if (t.bg_color) document.documentElement.style.setProperty('--bg-color', t.bg_color);
          if (t.text_color) document.documentElement.style.setProperty('--text-color', t.text_color);
          if (t.button_color) {
            document.documentElement.style.setProperty('--btn-gradient-start', t.button_color);
            document.documentElement.style.setProperty('--btn-gradient-end', t.button_color);
          }
          if (t.button_text_color) document.documentElement.style.setProperty('--btn-text-color', t.button_text_color);
        });
      }
    }

    // Запускаем инициализацию после загрузки DOM
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
