<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Кейс‑казино • Telegram версия</title>
  <!--
    Этот документ представляет собой переработанную версию оригинального «Кейс‑казино»,
    приспособленную для использования как обычного сайта, так и мини‑приложения
    Telegram. Основные изменения включают поддержку безопасных отступов для
    полноэкранного режима, использование CSS‑переменных для динамического
    применения темы Telegram, более гибкие размеры и улучшенную доступность.

    Чтобы изменить тему, скрипт внизу страницы считывает параметры Telegram
    (bg_color, text_color, button_color и др.) и применяет их к переменным,
    определённым в :root. Если приложение запущено вне Telegram, используются
    стандартные значения.

    Согласно рекомендациям Telegram Mini Apps, все элементы имеют мобильную
    ориентацию и соблюдают безопасную зону экрана【365779233254398†L342-L354】.
  -->
  <!-- Подключаем скрипт Telegram Web Apps SDK. Он не помешает, если страница
       открыта как обычный сайт: наличие объекта Telegram проверяется в коде -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      /* Базовые цвета. Они будут переопределены скриптом, если доступна тема Telegram */
      --bg-color: #0a1a0a;
      --text-color: #ffffff;
      --card-bg: rgba(0, 0, 0, 0.6);
      --btn-gradient-start: #ffea70;
      --btn-gradient-end: #d4af37;
      --btn-text-color: #0e0e0e;
    }

    /* Сброс отступов и базовая типографика */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      /* Поддержка безопасных зон для устройств с вырезами (iPhone) */
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      overflow-y: auto;
      touch-action: manipulation;
    }

    /* Общие стили для всех страниц */
    .page {
      position: absolute;
      inset: 0;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 16px;
      gap: 1rem;
      background-size: cover;
      background-position: center;
      overflow-y: auto;
    }

    /* Заголовки и подзаголовки */
    h1 {
      font-size: clamp(1.7rem, 6.5vw, 2.4rem);
      text-align: center;
      line-height: 1.2;
      text-shadow: 0 3px 12px #000;
      margin-top: 0.5rem;
    }

    .subtitle {
      font-size: clamp(1rem, 4vw, 1.2rem);
      text-align: center;
      line-height: 1.35;
      max-width: 96%;
      opacity: 0.92;
      margin-bottom: 0.5rem;
    }

    /* Кнопки */
    .btn {
      padding: 14px 32px;
      font-size: clamp(1.05rem, 4.2vw, 1.15rem);
      font-weight: 600;
      background-image: linear-gradient(145deg, var(--btn-gradient-start), var(--btn-gradient-end));
      color: var(--btn-text-color);
      border: none;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.55);
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease;
      min-width: 150px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 234, 112, 0.35);
    }

    .btn:active {
      transform: scale(0.97);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 14px 20px;
      width: 100%;
      margin-top: auto;
      padding-bottom: 12px;
    }

    /* Звёздный фон для генераторов */
    .stars {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .star {
      position: absolute;
      background: #fff;
      border-radius: 50%;
      opacity: 0.3;
      animation: twinkle 5s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.2; transform: scale(0.9); }
      50%      { opacity: 0.65; transform: scale(1.15); }
    }

    /* Переходы между страницами */
    .page {
      animation: pageIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes pageIn {
      from { opacity: 0; transform: translateY(20px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    /* Анимация появления ТЗ */
    .tz-box.reveal {
      animation: tzReveal 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes tzReveal {
      from { opacity: 0; transform: translateY(-12px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    /* Слот-машина: вращение при генерации */
    #design .gen-img {
      transform-style: preserve-3d;
    }

    #design .gen-img.spinning {
      animation: slotSpin 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes slotSpin {
      0% { transform: rotateY(0deg) scale(1); }
      50% { transform: rotateY(180deg) scale(1.1); }
      100% { transform: rotateY(360deg) scale(1); }
    }

    /* Кубики: тряска при генерации */
    .gen-img.shaking {
      animation: diceShake 0.6s cubic-bezier(0.36, 0.07, 0.19, 0.97) forwards;
    }

    @keyframes diceShake {
      0%, 100% { transform: translateX(0) rotate(0deg); }
      20% { transform: translateX(-8px) rotate(-5deg); }
      40% { transform: translateX(8px) rotate(5deg); }
      60% { transform: translateX(-6px) rotate(-3deg); }
      80% { transform: translateX(6px) rotate(3deg); }
    }

    /* Главная страница */
    #home {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 2vh;
      background-image: url('home_bg.webp');
      text-align: center;
    }

    #home img.hand {
      width: clamp(200px, 48vw, 280px);
      animation: handAppear 2.2s ease-out;
      margin-bottom: 16px;
    }

    @keyframes handAppear {
      0%   { opacity: 0; transform: translateY(60%) rotate(-8deg) scale(0.85); }
      70%  { opacity: 1; transform: translateY(0) rotate(4deg) scale(1.05); }
      100% { transform: translateY(0) rotate(0deg) scale(1); }
    }

    #home .cards {
      display: flex;
      gap: 24px;
      margin: 12px 0;
    }

    #home .card {
      width: clamp(100px, 32vw, 150px);
      cursor: pointer;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
      border-radius: 12px;
    }

    #home .card:hover {
      transform: translateY(-8px) scale(1.05);
      box-shadow: 0 12px 28px rgba(255, 234, 112, 0.25);
    }

    #home .card:active {
      transform: scale(1.08);
    }

    #home .pick-hint {
      animation: hintPulse 2s ease-in-out infinite;
      opacity: 0.9;
    }

    @keyframes hintPulse {
      0%, 100% { opacity: 0.85; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.02); }
    }

    #home .card.picked {
      animation: cardPicked 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes cardPicked {
      0% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.15); filter: brightness(1.3); }
      100% { transform: scale(1.05); filter: brightness(1.1); }
    }

    /* Страница загрузки */
    #loading {
      background-image: url('scene_bg.webp');
      justify-content: flex-start;
      align-items: center;
      padding-top: 6vh;
    }

    #loading .dealer {
      width: clamp(220px, 55vw, 340px);
      max-height: 52vh;
      object-fit: contain;
      margin: 12px 0 20px;
      animation: dealerWave 2s ease-in-out infinite;
    }

    @keyframes dealerWave {
      0%, 100% { transform: translateY(0) rotate(-1deg); }
      50% { transform: translateY(-6px) rotate(1deg); }
    }

    #loading .dialog {
      text-align: center;
      margin-top: auto;
      padding-bottom: 10px;
      max-width: 90%;
    }

    /* Страницы генераторов */
    #design,
    #marketing {
      justify-content: flex-start;
      align-items: center;
      padding-top: 5vh;
      gap: 1.2vh;
    }

    #design {
      background-image: url('design_bg.webp');
      perspective: 600px;
    }
    #marketing { background-image: url('marketing_bg.webp'); }

    .gen-img {
      width: clamp(160px, 42vw, 220px);
      margin: 12px 0 16px;
      cursor: pointer;
      transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .gen-img:hover {
      transform: scale(1.08);
    }

    #design .gen-img:hover { animation: slotPulse 1.5s ease-in-out infinite; }
    #marketing .gen-img:hover { animation: diceFloat 2s ease-in-out infinite; }

    @keyframes slotPulse {
      0%, 100% { filter: drop-shadow(0 0 8px rgba(255, 234, 112, 0.4)); }
      50% { filter: drop-shadow(0 0 20px rgba(255, 234, 112, 0.7)); }
    }

    @keyframes diceFloat {
      0%, 100% { transform: scale(1.08) translateY(0); }
      50% { transform: scale(1.08) translateY(-4px); }
    }

    /* Контейнер для сгенерированного ТЗ */
    .tz-box {
      background: var(--card-bg);
      backdrop-filter: blur(8px);
      border-radius: 10px;
      padding: 12px 14px;
      width: 92%;
      max-width: 500px;
      font-size: clamp(0.92rem, 3.5vw, 1.1rem);
      line-height: 1.4;
      word-wrap: break-word;
    }

    /* Чекбоксы в дизайнерском генераторе */
    .checkboxes {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px 16px;
      margin: 12px 0;
      font-size: clamp(0.9rem, 3.6vw, 1rem);
    }

    .checkboxes label {
      background: rgba(255, 255, 255, 0.07);
      padding: 8px 14px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s ease;
    }

    .checkboxes label:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: scale(1.03);
    }

    .checkboxes input[type="checkbox"] {
      accent-color: var(--btn-gradient-end);
    }

    .checkboxes input[type="text"] {
      background: rgba(255, 255, 255, 0.07);
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      color: var(--text-color);
      outline: none;
      width: 140px;
    }

    select {
      padding: 10px 16px;
      font-size: 1rem;
      background: rgba(30, 30, 30, 0.75);
      color: var(--text-color);
      border: 1px solid #444;
      border-radius: 8px;
      margin: 10px 0;
      width: 90%;
      max-width: 360px;
    }

    /* Адаптация для планшетов и десктопов */
    @media (min-width: 768px) {
      h1 { font-size: 2.6rem; }
      .gen-img { width: 240px; }
      .btn { padding: 14px 40px; font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <!-- Главная -->
  <div id="home" class="page">
    <img src="home_hand.png" class="hand" alt="Ладонь, приглашающая выбрать карту" />
    <div class="cards">
      <img src="card_design.png" class="card" onclick="selectRole('design')" alt="Карта дизайнера" />
      <img src="card_marketing.png" class="card" onclick="selectRole('marketing')" alt="Карта маркетолога" />
    </div>
    <p class="pick-hint">Выберите карту</p>
  </div>

  <!-- Страница загрузки -->
  <div id="loading" class="page">
    <img src="scene_dealer.webp" class="dealer" alt="Дилер приглашает" />
    <div class="dialog">
      <p>У меня есть пара интересных кейсов для тебя</p>
      <div class="buttons btn-row">
        <button class="btn" onclick="goToGenerator()">Хорошо, идём</button>
        <button class="btn" onclick="goHome()">Я не определился с картой</button>
      </div>
    </div>
  </div>

  <!-- Генератор для дизайнеров -->
  <div id="design" class="page">
    <div class="stars"></div>
    <h1>Генератор кейсов для дизайнеров</h1>
    <p class="subtitle">Сгенерируйте идею для кейса: лого, презентация, мерч или брендбук</p>
    <img src="design_slot.png" class="gen-img" onclick="generateDesign()" alt="Слот‑машина с дизайном" />
    <div id="design-tz" class="tz-box"></div>
    <div class="checkboxes">
      <label><input type="checkbox" value="логотип" /> Логотип</label>
      <label><input type="checkbox" value="мерч" /> Мерч</label>
      <label><input type="checkbox" value="брендбук" /> Брендбук</label>
      <label><input type="checkbox" value="презентация" /> Презентация</label>
      <label><input type="checkbox" value="маскот" /> Маскот</label>
      <label><input type="text" id="custom-design" placeholder="Своё" /></label>
    </div>
    <div class="btn-row">
      <button class="btn" onclick="copyDesignTZ()">Скопировать ТЗ</button>
      <button class="btn" onclick="clearTZ('design')">Стереть</button>
      <button class="btn" onclick="goHome()">Домой</button>
    </div>
  </div>

  <!-- Генератор для маркетологов -->
  <div id="marketing" class="page">
    <div class="stars"></div>
    <h1>Генератор кейсов для маркетологов</h1>
    <p class="subtitle">Сгенерируйте идею для кейса: презентация, исследование, брендбук, сравнение и др.</p>
    <img src="marketing_dice.png" class="gen-img" onclick="generateMarketing()" alt="Кубики для генерации" />
    <div id="marketing-tz" class="tz-box"></div>
    <select id="marketing-type">
      <option value="презентация">Презентация</option>
      <option value="исследование">Исследование</option>
      <option value="брендбук">Брендбук</option>
      <option value="сравнение">Сравнение</option>
      <option value="другое">Другое</option>
    </select>
    <div class="btn-row">
      <button class="btn" onclick="copyMarketingTZ()">Скопировать ТЗ</button>
      <button class="btn" onclick="clearTZ('marketing')">Стереть</button>
      <button class="btn" onclick="goHome()">Домой</button>
    </div>
  </div>

  <script>
    // Логичные кейсы: компания + продукт + позиционирование связаны по домену (индустрии)
    const caseDomains = [
      {
        company: "CodeCraft Software",
        positioning: "Надежное ПО для бизнеса любого масштаба",
        products: ["CRM‑система", "AI‑платформа для автоматизации", "SaaS‑платформа", "BI‑инструменты"],
        designProblems: ["Устаревший логотип не отражает современный бренд", "Несоответствие цветовой палитры в UI/UX", "Перегруженный интерфейс с лишними элементами", "Плохая визуализация данных в дашбордах", "Проблемы с навигацией в веб‑приложении", "Несогласованность иконок в приложении"],
        marketingProblems: ["Низкий трафик на сайт из поисковиков", "Слабый B2B lead nurturing", "Низкая видимость в поисковых системах", "Проблемы с сегментацией аудитории", "Слабый engagement в контент‑маркетинге", "Высокий cost per click"],
        tasks: ["Разработать кампанию по повышению бренд‑осведомленности", "Проанализировать конкурентов и предложить дифференциацию", "Создать контент для B2B‑аудитории", "Улучшить программу лояльности клиентов", "Облачный B2B‑маркетинг"],
        goals: ["Увеличить долю рынка на 15%", "Достичь 100k SaaS‑подписчиков", "Улучшить точность данных на 25%", "Масштабировать до enterprise", "Обеспечить 99.9% uptime"],
        colors: ["Blue / #0000FF", "Teal / #008080", "Navy / #000080", "Indigo / #4B0082"]
      },
      {
        company: "BrewBuddy Coffee",
        positioning: "Кофе для бодрого старта дня",
        products: ["Кофейные зерна премиум‑класса", "Готовый холодный кофе", "Кофейные капсулы", "Подарочные наборы кофе"],
        designProblems: ["Скучный визуальный стиль упаковки", "Устаревший дизайн баннеров", "Отсутствие уникального маскота", "Низкое качество изображений на сайте", "Несогласованность цветов в палитре", "Плохая композиция landing page"],
        marketingProblems: ["Низкие продажи в offseason", "Слабый бренд‑awareness", "Высокий cart abandonment", "Низкий engagement в соцсетях", "Проблемы с сезонным маркетингом", "Конкуренция в e‑commerce"],
        tasks: ["Кофейный брендинг", "Создать сезонную промо‑стратегию", "Разработать кампанию по повышению бренд‑осведомленности", "Улучшить программу лояльности клиентов", "Маркетинг для кофейной аудитории"],
        goals: ["Достичь 1 тонны продаж кофе в месяц", "Увеличить повторные покупки на 40%", "Расширить онлайн‑присутствие", "Увеличить долю рынка на 15%", "Повысить продажи в offseason на 20%"],
        colors: ["Brown / #A52A2A", "Sienna / #A0522D", "Maroon / #800000", "DarkGoldenrod / #B8860B"]
      },
      {
        company: "GlowBeauty Cosmetics",
        positioning: "Натуральная косметика для сияющей кожи",
        products: ["Кремы для лица", "Сыворотки для кожи", "Маски для лица", "Наборы для ухода"],
        designProblems: ["Устаревшие иллюстрации в мерче", "Низкая привлекательность обложек", "Плохая интеграция видео в интерфейс", "Отсутствие 3D‑элементов для продуктов", "Конфликт стилей в соцсетях", "Слабый дизайн упаковки"],
        marketingProblems: ["Слабый охват в influencer‑маркетинге", "Низкие конверсии из соцсетей", "Проблемы с персонализацией предложений", "Высокий churn rate подписчиков", "Слабый viral эффект кампаний", "Низкий NPS score"],
        tasks: ["Кампания по уходу за кожей", "Уход за кожей маркетинг", "Разработать influencer‑стратегию", "Создать контент для соцсетей", "Улучшить программу лояльности"],
        goals: ["Достичь 5 млн продаж косметики", "Лидер в skincare", "Увеличить retention до 70%", "Расширить онлайн‑присутствие", "Увеличить долю рынка на 15%"],
        colors: ["Pink / #FFC0CB", "HotPink / #FF69B4", "Lavender / #E6E6FA", "Coral / #FF7F50"]
      },
      {
        company: "FitTrack Gear",
        positioning: "Спортивное оборудование для активного образа жизни",
        products: ["Фитнес‑трекеры", "Протеиновые шейкеры", "Йога‑маты и аксессуары", "Спортивная одежда"],
        designProblems: ["Отсутствие анимаций для вовлечения", "Проблемы с responsive дизайном", "Слабый фокус на CTA", "Устаревший стиль икон‑сета", "Плохая визуальная иерархия", "Несовместимость с dark mode"],
        marketingProblems: ["Низкий engagement в webinars", "Проблемы с сегментацией аудитории", "Слабый user‑generated content", "Высокие затраты на acquisition", "Низкий lifetime value клиентов", "Проблемы с ретаргетингом"],
        tasks: ["Маркетинг безопасного фитнеса", "Мотивирующий контент для фитнеса", "Разработать UGC‑кампанию", "Создать сезонную промо‑стратегию", "Улучшить программу лояльности"],
        goals: ["Увеличить engagement в фитнесе", "Минимизировать травмы через образование", "Увеличить retention до 70%", "Достичь 1 млн пользователей", "Расширить онлайн‑присутствие"],
        colors: ["Lime / #00FF00", "Orange / #FFA500", "Cyan / #00FFFF", "Green / #008000"]
      },
      {
        company: "AdventureQuest Travel",
        positioning: "Приключенческие туры для искателей адреналина",
        products: ["Туристические пакеты", "Экскурсионные туры", "Отельные пакеты", "Трекинг‑туры"],
        designProblems: ["Слабый визуальный storytelling в презентациях", "Устаревший дизайн email‑рассылок", "Низкое качество изображений на сайте", "Отсутствие immersive дизайна", "Плохая композиция landing page", "Несогласованность в UI kits"],
        marketingProblems: ["Высокий bounce rate на landing pages", "Низкие конверсии из соцсетей", "Проблемы с сезонным маркетингом", "Слабый PR в СМИ", "Высокие затраты на content creation", "Низкий share of voice"],
        tasks: ["Безопасный туристический маркетинг", "Персонализированный тревел‑маркетинг", "Адаптировать туры под новые регуляции", "Создать контент для соцсетей", "Разработать сезонную промо‑стратегию"],
        goals: ["Обеспечить безопасность туров", "Персонализировать 80% туров", "Увеличить повторные визиты на 40%", "Расширить онлайн‑присутствие", "Достичь 1 млн пользователей"],
        colors: ["Turquoise / #40E0D0", "Teal / #008080", "Coral / #FF7F50", "Gold / #FFD700"]
      },
      {
        company: "StyleForge Apparel",
        positioning: "Современная мода для уверенных в себе людей",
        products: ["Линейка уличной одежды", "Аксессуары для одежды", "Сумки и рюкзаки", "Коллекция базовых вещей"],
        designProblems: ["Конфликт стилей в соцсетях", "Устаревшие иллюстрации в мерче", "Несовместимость брендбука с новыми продуктами", "Слабый дизайн инфографики", "Проблемы с white space в layouts", "Низкая привлекательность обложек"],
        marketingProblems: ["Отток аудитории в соцсетях", "Конкуренция в e‑commerce", "Слабый influencer‑маркетинг", "Низкие подписки на newsletter", "Проблемы с A/B‑тестированием", "Высокий cart abandonment"],
        tasks: ["Трендовый маркетинг моды", "Устойчивый фэшн‑маркетинг", "Создать контент для соцсетей", "Разработать influencer‑стратегию", "Проанализировать конкурентов"],
        goals: ["Лидерство в fast fashion", "Увеличить долю рынка на 15%", "Расширить онлайн‑присутствие", "Увеличить retention до 70%", "Достичь 1 млн подписчиков"],
        colors: ["Black / #000000", "Magenta / #FF00FF", "Silver / #C0C0C0", "Gold / #FFD700"]
      },
      {
        company: "GreenLeaf Energy",
        positioning: "Возобновляемая энергия для зеленого мира",
        products: ["Солнечные панели", "Инверторы для солнечных систем", "Батареи для хранения энергии", "Умные термостаты"],
        designProblems: ["Устаревший логотип не отражает экологичность", "Отсутствие motion design в промо", "Плохая визуализация данных в дашбордах", "Слабый дизайн инфографики", "Несогласованность цветов в палитре", "Проблемы с доступностью"],
        marketingProblems: ["Слабый бренд‑awareness", "Проблемы с B2B lead nurturing", "Низкая видимость в поисковых системах", "Высокие затраты на acquisition", "Проблемы с маркетинг‑автоматизацией", "Низкий share of voice"],
        tasks: ["Продвигать зелёные инициативы", "Продвигать энергоэффективность", "Продвижение солнечной энергии", "Энерго‑хранение продвижение", "Разработать B2B‑кампанию"],
        goals: ["Стать лидером в зеленой энергии", "Снизить энергопотребление на 30%", "Покрыть 20% рынка солнечных", "Хранить 100% энергии", "Привлечь 5 млн инвестиций"],
        colors: ["Green / #008000", "Teal / #008080", "Lime / #00FF00", "ForestGreen / #228B22"]
      },
      {
        company: "PetPals Supplies",
        positioning: "Качественные товары для любимых питомцев",
        products: ["Корм для собак", "Аксессуары для питомцев", "Игрушки для кошек", "Наборы для ухода"],
        designProblems: ["Отсутствие уникального маскота", "Скучный визуальный стиль упаковки", "Низкая привлекательность обложек", "Устаревший дизайн баннеров", "Конфликт стилей в соцсетях", "Проблемы с white space"],
        marketingProblems: ["Слабый охват в influencer‑маркетинге", "Низкие конверсии из соцсетей", "Проблемы с сегментацией аудитории", "Высокий churn rate подписчиков", "Слабый user‑generated content", "Низкий NPS score"],
        tasks: ["Кампании для владельцев питомцев", "Разработать influencer‑стратегию", "Создать UGC‑кампанию", "Улучшить программу лояльности", "Создать контент для соцсетей"],
        goals: ["Стать топ‑брендом для pets", "Увеличить retention до 70%", "Расширить онлайн‑присутствие", "Увеличить долю рынка на 15%", "Достичь 1 млн подписчиков"],
        colors: ["Orange / #FFA500", "Brown / #A52A2A", "Green / #008000", "Gold / #FFD700"]
      },
      {
        company: "EduQuest Learning",
        positioning: "Интерактивное обучение для детей и взрослых",
        products: ["Онлайн‑курсы", "Образовательные приложения", "Пазлы для мозга", "Обучающие материалы"],
        designProblems: ["Плохая читаемость шрифтов на мобильных", "Отсутствие анимаций для вовлечения", "Перегруженный интерфейс", "Проблемы с доступностью", "Слабый дизайн error pages", "Несогласованность иконок"],
        marketingProblems: ["Высокий churn rate подписчиков", "Низкий engagement в webinars", "Проблемы с retention‑маркетингом", "Слабый lead generation", "Высокие затраты на acquisition", "Низкие подписки на newsletter"],
        tasks: ["Retention‑стратегии для курсов", "Маркетинг образовательных инструментов", "Разработать кампанию по повышению бренд‑осведомленности", "Улучшить программу лояльности", "Создать контент для соцсетей"],
        goals: ["Снизить dropout до 10%", "Достичь 1 млн пользователей", "Улучшить концентрацию учеников", "Увеличить retention до 70%", "Расширить онлайн‑присутствие"],
        colors: ["Blue / #0000FF", "Purple / #800080", "Teal / #008080", "Indigo / #4B0082"]
      },
      {
        company: "GameForge Studios",
        positioning: "Игровые студии для эпичных приключений",
        products: ["Видеоигры", "VR‑очки и контент", "Мобильные игры", "Игровые аксессуары"],
        designProblems: ["Отсутствие immersive дизайна для VR", "Устаревший стиль икон‑сета", "Плохая анимация переходов", "Отсутствие 3D‑элементов", "Слабый motion design в промо", "Проблемы с dark mode"],
        marketingProblems: ["Низкие метрики в app installs", "Конкуренция в видео‑рекламе", "Слабый viral эффект кампаний", "Высокие затраты на acquisition", "Проблемы с ретаргетингом", "Низкий engagement в соцсетях"],
        tasks: ["Гейм‑маркетинг", "Разработать viral‑кампанию", "Создать контент для стримеров", "Улучшить программу лояльности", "Маркетинг VR для образования"],
        goals: ["Выпустить хит‑игру", "Достичь 1 млн пользователей", "Сделать VR mainstream", "Увеличить retention до 70%", "Расширить онлайн‑присутствие"],
        colors: ["Purple / #800080", "Cyan / #00FFFF", "Magenta / #FF00FF", "Indigo / #4B0082"]
      }
    ];

    let currentRole = "";
    let tg = null;

    function randomItem(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function showPage(id) {
      document.querySelectorAll(".page").forEach(p => p.style.display = "none");
      const el = document.getElementById(id);
      el.style.display = "flex";
      if (id === "design" || id === "marketing") createStars(id);
    }

    function selectRole(role) {
      currentRole = role;
      const card = document.querySelector(`#home .card[onclick*="${role}"]`);
      if (card) {
        card.classList.add("picked");
        setTimeout(() => card.classList.remove("picked"), 500);
      }
      showPage("loading");
    }

    function goToGenerator() {
      showPage(currentRole);
    }

    function goHome() {
      showPage("home");
    }

    function generateDesign() {
      const domain = randomItem(caseDomains);
      const col = randomItem(domain.colors);
      const prod = randomItem(domain.products);
      const prob = randomItem(domain.designProblems);
      const tzBox = document.getElementById("design-tz");
      tzBox.classList.remove("reveal");
      tzBox.innerHTML = `
        <p class="tz">Компания: ${domain.company}</p>
        <p class="tz">Позиционирование: ${domain.positioning}</p>
        <p class="tz">Цвет: ${col}</p>
        <p class="tz">Продукт: ${prod}</p>
        <p class="tz">Проблема: ${prob}</p>
      `;
      tzBox.offsetHeight;
      tzBox.classList.add("reveal");
      const img = document.querySelector("#design .gen-img");
      img.classList.remove("spinning");
      img.offsetHeight;
      img.classList.add("spinning");
      setTimeout(() => img.classList.remove("spinning"), 800);
    }

    function generateMarketing() {
      const domain = randomItem(caseDomains);
      const prod = randomItem(domain.products);
      const prob = randomItem(domain.marketingProblems);
      const t = randomItem(domain.tasks);
      const g = randomItem(domain.goals);
      const tzBox = document.getElementById("marketing-tz");
      tzBox.classList.remove("reveal");
      tzBox.innerHTML = `
        <p class="tz">Компания: ${domain.company}</p>
        <p class="tz">Позиционирование: ${domain.positioning}</p>
        <p class="tz">Продукт: ${prod}</p>
        <p class="tz">Проблема: ${prob}</p>
        <p class="tz">Задача: ${t}</p>
        <p class="tz">Цель: ${g}</p>
      `;
      tzBox.offsetHeight;
      tzBox.classList.add("reveal");
      const img = document.querySelector("#marketing .gen-img");
      img.classList.remove("shaking");
      img.offsetHeight;
      img.classList.add("shaking");
      setTimeout(() => img.classList.remove("shaking"), 600);
    }

    // Универсальная функция показа алерта через Telegram или стандартный alert
    function showAlert(message) {
      if (tg && typeof tg.showAlert === "function") {
        tg.showAlert(message);
      } else {
        alert(message);
      }
    }

    // Скопировать ТЗ для дизайнера. В Telegram используется tg.showAlert
    function copyDesignTZ() {
      const tz = document.getElementById("design-tz");
      if (!tz.innerText.trim()) return showAlert("Сначала сгенерируйте ТЗ");
      const checks = Array.from(document.querySelectorAll("#design input[type=checkbox]:checked")).map(c => c.value);
      const custom = document.getElementById("custom-design").value.trim();
      const items = [...checks, custom].filter(Boolean).join(", ") || "дизайн";
      const lines = tz.innerText.split("\n").map(l => l.split(": ")[1] || "");
      // lines: [Компания, Позиционирование, Цвет, Продукт, Проблема]
      const text = `Привет! Мы из ${lines[0]}. Занимаемся ${lines[3]}. Столкнулись с проблемой ${lines[4]}.\n` +
                   `Очень нужна помощь! Директор просит сделать тебе ${items}. Учти, что основной цвет — ${lines[2]}, и дизайн должен соответствовать позиционированию: ${lines[1]}.\n` +
                   `Доверяем твоему вкусу, ноль правок. Ждём решение!`;
      // Запись в буфер обмена
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => showAlert("ТЗ скопировано"));
      } else {
        showAlert(text);
      }
    }

    // Скопировать ТЗ для маркетолога
    function copyMarketingTZ() {
      const tz = document.getElementById("marketing-tz");
      if (!tz.innerText.trim()) return showAlert("Сначала сгенерируйте ТЗ");
      const type = document.getElementById("marketing-type").value;
      const lines = tz.innerText.split("\n").map(l => l.split(": ")[1] || "");
      // lines: [Компания, Позиционирование, Продукт, Проблема, Задача, Цель]
      const text = `Привет! Мы из ${lines[0]}. Занимаемся ${lines[2]}. Проблема: ${lines[3]}.\n` +
                   `Нужна твоя помощь! Директор просит решить задачу: ${lines[4]}. Решение должно соответствовать позиционированию (${lines[1]}).\n` +
                   `Цель квартала: ${lines[5]}. Ноль правок. Ждём! (Тип: ${type})`;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => showAlert("ТЗ скопировано"));
      } else {
        showAlert(text);
      }
    }

    // Очистить ТЗ и чекбоксы
    function clearTZ(role) {
      document.getElementById(role + "-tz").innerHTML = "";
      if (role === "design") {
        document.querySelectorAll("#design input[type=checkbox]").forEach(i => i.checked = false);
        document.getElementById("custom-design").value = "";
      }
    }

    // Создание звёздного фона на генераторных страницах
    function createStars(id) {
      const container = document.querySelector(`#${id} .stars`);
      container.innerHTML = "";
      const count = window.innerWidth > 768 ? 60 : 35;
      for (let i = 0; i < count; i++) {
        const s = document.createElement("div");
        s.className = "star";
        const size = Math.random() * 3 + 1;
        s.style.width = size + "px";
        s.style.height = size + "px";
        s.style.top = Math.random() * 100 + "%";
        s.style.left = Math.random() * 100 + "%";
        s.style.animationDelay = Math.random() * 5 + "s";
        container.appendChild(s);
      }
    }

    // Инициализация страницы
    function init() {
      showPage("home");
      // Проверяем наличие Telegram API
      if (window.Telegram && window.Telegram.WebApp) {
        tg = window.Telegram.WebApp;
        tg.ready();
        // Расширяем приложение, если это Mini App
        if (typeof tg.expand === "function") tg.expand();
        // Получаем тему и применяем к CSS‑переменным
        const theme = tg.themeParams || {};
        if (theme.bg_color) document.documentElement.style.setProperty('--bg-color', theme.bg_color);
        if (theme.text_color) document.documentElement.style.setProperty('--text-color', theme.text_color);
        // Telegram предоставляет цвета кнопок. Используем их, если доступны
        if (theme.button_color && theme.button_color.startsWith('#')) {
          document.documentElement.style.setProperty('--btn-gradient-start', theme.button_color);
          document.documentElement.style.setProperty('--btn-gradient-end', theme.button_color);
        }
        if (theme.button_text_color) document.documentElement.style.setProperty('--btn-text-color', theme.button_text_color);
        // Слушаем изменение темы и обновляем цвета
        tg.onEvent('themeChanged', () => {
          const t = tg.themeParams || {};
          if (t.bg_color) document.documentElement.style.setProperty('--bg-color', t.bg_color);
          if (t.text_color) document.documentElement.style.setProperty('--text-color', t.text_color);
          if (t.button_color) {
            document.documentElement.style.setProperty('--btn-gradient-start', t.button_color);
            document.documentElement.style.setProperty('--btn-gradient-end', t.button_color);
          }
          if (t.button_text_color) document.documentElement.style.setProperty('--btn-text-color', t.button_text_color);
        });
      }
    }

    // Запускаем инициализацию после загрузки DOM
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
